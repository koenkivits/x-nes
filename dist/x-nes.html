<script>!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){exports.readFile=function(filename,callback){var xhr=new XMLHttpRequest;xhr.open("GET",filename),xhr.responseType="arraybuffer",xhr.onload=function(){callback(xhr.response)},xhr.onerror=function(e){throw e},xhr.send(null)}},{}],2:[function(require,module){module.exports={input:[{type:"standard",input:"keyboard",config:{x:"a",z:"b",shift:"select","return":"start",up:"up",down:"down",left:"left",right:"right"}}]}},{}],3:[function(require,module){function System(el){this.config=config,this.frameEnded=!1,this.tickAPU=!1,this.controllers=new Controllers,this.input=new Input(this),this.output=new Output,el&&this.output.video.setElement(el),this.interval=null,this.running=!1,this.paused=!0,this.cartridge=null,this.cpu=null,this.apu=null,this.ppu=null,this.memory=null,Object.preventExtensions(this)}var CPU=require("./system/cpu"),APU=require("./system/apu"),PPU=require("./system/ppu"),Cartridge=require("./system/cartridge"),Controllers=require("./system/controllers"),Output=require("./system/output"),Memory=require("./system/memory"),utils=require("utils"),Input=require("./system/input"),config=require("./config.json");System.prototype={load:function(filename,autorun){var self=this;utils.readFile(filename,function(data){self.initCartridge(data),"function"==typeof autorun?autorun():autorun===!0&&self.run()})},run:function(){if(!this.interval){var self=this;this.interval=setInterval(function(){self.paused||self.runFrame()},1e3/60),this.output.video.run(),this.running=!0,this.paused=!1}},runFrame:function(){for(;!this.frameEnded;)this.cpu.tick(),this.ppu.tick(),this.ppu.tick(),this.ppu.tick(),this.tickAPU&&this.apu.tick(),this.tickAPU=!this.tickAPU;this.frameEnded=!1},simulate:function(milliseconds){var i,frames=milliseconds/1e3*60;for(i=0;frames>i;i++)this.runFrame()},play:function(){this.paused=!1,this.running||this.run()},pause:function(){this.paused=!0},toggle:function(){return this.paused?this.play():this.pause(),this.paused},initCartridge:function(data){var cartridge=new Cartridge(data,this);this.cartridge=cartridge,this.initCore(),this.reset()},initCore:function(){this.cpu=new CPU(this),this.apu=new APU(this),this.ppu=new PPU(this),this.memory=new Memory(this)},reset:function(){this.cpu.reset(),this.apu.reset()}},module.exports=System},{"./config.json":2,"./system/apu":6,"./system/cartridge":10,"./system/controllers":11,"./system/cpu":13,"./system/input":14,"./system/memory":23,"./system/output":25,"./system/ppu":29,utils:1}],4:[function(require,module){"use strict";function Channel(){this.enabled=!1,this.lengthCounter=0,this.lengthCounterHalt=!1,this.sample=0,this.volume=0,this.masterVolume=0,this.envelopeStart=!0,this.envelopeLoop=!1,this.envelopeCounter=0,this.envelopeDividerPeriod=0,this.envelopeDividerCount=0,this.envelopeDisabled=!1}Channel.prototype={toggle:function(flag){flag?this.enable():this.disable()},disable:function(){this.enabled=!1,this.lengthCounter=0},enable:function(){this.enabled=!0},doLengthCounter:function(){this.lengthCounter&&!this.lengthCounterHalt&&this.lengthCounter--,2===this.index&&!this.lengthCounter},setLengthCounter:function(value){this.enabled&&(this.lengthCounter=lengthCounterLookup[value])},doEnvelope:function(){this.envelopeStart?(this.envelopeStart=!1,this.envelopeCounter=15,this.envelopeDividerCount=this.envelopeDividerPeriod):this.envelopeDividerCount?(this.envelopeDividerCount-=1,0===this.envelopeDividerCount&&(0===this.envelopeCounter&&this.envelopeLoop?this.envelopeCounter=15:this.envelopeCounter&&(this.envelopeCounter-=1),this.envelopeDividerCount=this.envelopeDividerPeriod)):this.envelopeCounter=0,this.masterVolume=this.envelopeDisabled?this.volume:this.envelopeCounter},setEnvelope:function(value){this.volume=15&value,this.lengthCounterHalt=this.envelopeLoop=!!(32&value),this.envelopeDisabled=!!(16&value),this.envelopeDividerPeriod=this.volume+1,this.envelopeStart=!0}};var lengthCounterLookup=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30];module.exports=Channel},{}],5:[function(require,module){"use strict";function DMC(apu){this.apu=apu,this.timerMax=periodLookup[0],this.timer=this.period,this.silence=!1,this.output=0,this.sampleAddress=0,this.sampleCurrentAddress=0,this.sampleLength=0,this.sampleBytesLeft=0,this.sampleBuffer=0,this.loop=!1,this.interrupt=!1,this.bitsLeft=8,this.shifter=0,this.irqEnabled=!1,Channel.call(this),Object.preventExtensions(this)}var Channel=require("./channel");DMC.prototype=new Channel,DMC.prototype.writeRegister=function(index,value){switch(index){case 0:this.irqEnabled=!!(128&value),this.irqEnabled||(this.interrupt=!1),this.loop=!!(64&value),this.timerMax=this.timer=periodLookup[15&value]>>>1;break;case 1:this.output=127&value;break;case 2:this.sampleAddress=this.sampleCurrentAddress=49152|value<<6;break;case 3:this.sampleLength=this.sampleBytesLeft=value&&value<<4|1}},DMC.prototype.doTimer=function(){this.timerMax&&(this.timer--,this.timer<=0&&(this.silence?this.sample=0:(this.output=1&this.shifter?Math.min(this.output+2,127):Math.max(this.output-2,0),this.sample=this.output),this.shifter>>>=1,this.bitsLeft--,this.bitsLeft||(this.bitsLeft=8,this.silence=!this.sampleBytesLeft,this.silence||this.readSample()),this.timer+=this.timerMax)),this.irqEnabled&&this.interrupt&&this.apu.system.cpu.requestIRQ()},DMC.prototype.readSample=function(){this.shifter=this.sampleBuffer,this.sampleBuffer=this.apu.system.memory.read(this.sampleCurrentAddress),this.sampleCurrentAddress++,65535===this.sampleCurrentAddress&&(this.sampleCurrentAddress=32768),this.sampleBytesLeft--,this.sampleBytesLeft||(this.sampleCurrentAddress=this.sampleAddress,this.loop?this.sampleBytesLeft=this.sampleLength:this.interrupt=this.irqEnabled)};var periodLookup=[428,380,340,320,286,254,226,214,190,160,142,128,106,84,72,54];module.exports=DMC},{"./channel":4}],6:[function(require,module){"use strict";function APU(system){this.system=system,this.output=system.output.audio,this.sampleCounter=0,this.sampleCounterMax=894886.5/this.output.sampleRate,this.frameCounterMode=0,this.frameCounterInterrupt=!1,this.frameCount=0,this.cycles=0,this.pulse1=new Pulse,this.pulse2=new Pulse,this.triangle=new Triangle,this.noise=new Noise,this.dmc=new DMC(this),Object.preventExtensions(this)}var Pulse=require("./pulse"),Triangle=require("./triangle"),Noise=require("./noise"),DMC=require("./dmc");APU.prototype={reset:function(){this.writeStatus(0)},readRegister:function(address){return 21===address?this.readStatus():0},readStatus:function(){return!!this.pulse1.lengthCounter<<0|!!this.pulse2.lengthCounter<<1|!!this.triangle.lengthCounter<<2|!!this.noise.lengthCounter<<3|!!this.dmc.sampleBytesLeft<<4},writeRegister:function(address,value){4>address?this.pulse1.writeRegister(address,value):8>address?this.pulse2.writeRegister(address-4,value):12>address?this.triangle.writeRegister(address-8,value):16>address?this.noise.writeRegister(address-12,value):20>address?this.dmc.writeRegister(address-16,value):21===address?this.writeStatus(value):23===address&&(this.frameCounterMode=+!!(128&value),this.frameCounterInterrupt=!(64&value),this.cycles=0,this.frameCounterMode&&(this.doQuarterFrame(),this.doHalfFrame()))},writeStatus:function(value){this.pulse1.toggle(1&value),this.pulse2.toggle(2&value),this.triangle.toggle(4&value),this.noise.toggle(8&value)},tick:function(){switch(this.frameCounterMode){case 0:this.tick0();break;default:this.tick1()}this.cycles+=1,this.updateSample()},tick0:function(){switch(this.cycles){case 3728:case 7457:case 11186:case 14915:this.doQuarterFrame()}switch(this.cycles){case 7457:case 14915:this.doHalfFrame()}this.cycles>=14915&&(this.cycles=0,this.frameCounterInterrupt&&this.system.cpu.requestIRQ())},tick1:function(){switch(this.cycles){case 3729:case 7457:case 11186:case 18641:this.doQuarterFrame()}switch(this.cycles){case 7457:case 18641:this.doHalfFrame()}this.cycles>=18641&&(this.cycles=0)},doQuarterFrame:function(){this.pulse1.doEnvelope(),this.pulse2.doEnvelope(),this.noise.doEnvelope(),this.triangle.doLinearCounter()},doHalfFrame:function(){this.pulse1.doSweep(),this.pulse1.doLengthCounter(),this.pulse2.doSweep(),this.pulse2.doLengthCounter(),this.triangle.doLengthCounter(),this.noise.doLengthCounter()},updateSample:function(){var tnd=0,tndOut=0,pulseOut=0;this.pulse1.doTimer(),this.pulse2.doTimer(),this.triangle.doTimer(),this.noise.doTimer(),this.dmc.doTimer(),this.output.enabled&&(this.sampleCounter>=this.sampleCounterMax&&(pulseOut=95.88/(8128/(this.pulse1.sample+this.pulse2.sample)+100),tndOut=0,(this.triangle.sample||this.noise.sample||this.dmc.sample)&&(tnd=this.triangle.sample/8227+this.noise.sample/12241+this.dmc.sample/22638,tndOut=159.79/(1/tnd+100)),this.output.writeSample(pulseOut+tndOut),this.sampleCounter-=this.sampleCounterMax),this.sampleCounter+=1)}},module.exports=APU},{"./dmc":5,"./noise":7,"./pulse":8,"./triangle":9}],7:[function(require,module){"use strict";function Noise(){this.shift=1,this.mode=0,this.timerMax=periodLookup[0],this.timer=this.period,this.index=3,Channel.call(this),Object.preventExtensions(this)}var Channel=require("./channel");Noise.prototype=new Channel,Noise.prototype.doTimer=function(){var feedback=0,otherBit=0;this.timerMax&&(this.timer?this.timer--:(otherBit=this.mode?(64&this.shift)>>6:(2&this.shift)>>1,feedback=1&(this.shift^otherBit),this.shift>>>=1,this.shift|=feedback<<14,this.sample=!this.lengthCounter||1&this.shift?0:this.masterVolume,this.timer+=this.timerMax))},Noise.prototype.writeRegister=function(index,value){switch(index){case 0:this.setEnvelope(value);break;case 1:break;case 2:this.mode=(128&value)>>>7,this.timerMax=this.timer=periodLookup[15&value];break;case 3:this.setLengthCounter(value>>>3),this.envelopeStart=!0}};var periodLookup=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068];module.exports=Noise},{"./channel":4}],8:[function(require,module){"use strict";function Pulse(){this.timerMax=0,this.timer=0,this.duty=0,this.sweepStart=!0,this.sweepEnabled=!1,this.sweepDividerPeriod=0,this.sweepDividerCount=0,this.sweepNegate=!1,this.sweepShiftCount=0,this.pulseCounter=0,this.silence=!1,Channel.call(this),Object.preventExtensions(this)}var Channel=require("./channel");Pulse.prototype=new Channel,Pulse.prototype.doSweep=function(){var adjustPulse=!this.sweepDividerCount,timerDelta=0,targetTimer=0;this.sweepStart&&(this.sweepDividerCount=this.sweepDividerPeriod,this.sweepStart=!1),adjustPulse?(this.sweepShiftCount&&(timerDelta=this.timerMax>>>this.sweepShiftCount),this.sweepNegate&&(timerDelta=-timerDelta),targetTimer=this.timerMax+timerDelta,this.timerMax>=8&&this.timerMax<=2047?(this.sweepEnabled&&(this.timerMax=targetTimer),this.silence=!1):this.silence=!0,this.sweepDividerCount=this.sweepDividerPeriod):this.sweepDividerCount&&this.sweepDividerCount--},Pulse.prototype.doTimer=function(){!this.silence&&this.lengthCounter&&this.timerMax?this.timer?this.timer--:(this.timer+=this.timerMax,this.pulseCounter=this.pulseCounter+1&7,this.sample=pulseDutyLookup[(this.duty<<3)+this.pulseCounter]*this.masterVolume):this.sample=0},Pulse.prototype.writeRegister=function(index,value){switch(index){case 0:this.duty=(192&value)>>6,this.setEnvelope(value);break;case 1:this.sweepStart=!0,this.sweepEnabled=!!(128&value),this.sweepDividerPeriod=((112&value)>>4)+1,this.sweepNegate=!!(8&value),this.sweepShiftCount=7&value;break;case 2:this.timer=this.timerMax=-256&this.timerMax|value;break;case 3:this.timer=this.timerMax=-65281&this.timerMax|(7&value)<<8,this.setLengthCounter(value>>>3),this.envelopeStart=!0,this.pulseCounter=0}this.silence=this.timerMax<8};var pulseDutyLookup=[0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,1,1,1,1];module.exports=Pulse},{"./channel":4}],9:[function(require,module){"use strict";function Triangle(){this.linearCounter=0,this.linearCounterMax=0,this.linearCounterControl=!1,this.linearCounterStart=!1,this.timerMax=0,this.timer=0,this.sequenceCounter=0,Channel.call(this),Object.preventExtensions(this)}var Channel=require("./channel");Triangle.prototype=new Channel,Triangle.prototype.doLinearCounter=function(){this.linearCounterStart?this.linearCounter=this.linearCounterMax:this.linearCounter&&this.linearCounter--,this.linearCounterControl||(this.linearCounterStart=!1)},Triangle.prototype.doTimer=function(){this.timerMax&&(this.timer-=2,this.timer<=0&&(this.timer+=this.timerMax,this.sequenceCounter=this.sequenceCounter+1&31,this.sample=sequence[this.sequenceCounter])),this.lengthCounter&&this.linearCounter||(this.sample=0)},Triangle.prototype.writeRegister=function(index,value){switch(index){case 0:this.linearCounterMax=-129&value,this.lengthCounterHalt=this.linearCounterControl=!!(128&value);break;case 1:break;case 2:this.timer=this.timerMax=-256&this.timerMax|value;break;case 3:this.timer=this.timerMax=-65281&this.timerMax|(7&value)<<8,this.setLengthCounter(value>>>3),this.linearCounterStart=!0}};var sequence=[15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15];module.exports=Triangle},{"./channel":4}],10:[function(require,module){"use strict";function Cartridge(data,system){this.system=system,this.raw=data,this.data=new Uint8Array(data,16,data.byteLength-16),this.header=new Uint8Array(data,0,16),this.validate(),this.initHeader(),this.initData(),Object.preventExtensions(this)}var mappers=require("./mappers");const HORIZONTAL=0,VERTICAL=1,FOUR_SCREEN=2,SINGLE_SCREEN_LOWER=3,SINGLE_SCREEN_UPPER=4;Cartridge.prototype={validate:function(){if(78!==this.header[0]||69!==this.header[1]||83!==this.header[2]||26!==this.header[3])throw new Error("Invalid ROM!");if(14&this.header[7])throw new Error("Bit 1-3 of byte 7 in ROM header must all be zeroes!");if(254&this.header[9])throw new Error("Bit 1-7 of byte 9 in header must all be zeroes!");var i;for(i=10;15>=i;i++)if(this.header[i])throw new Error("Byte "+i+" in ROM header must be zero.");if(4&this.header[6])throw new Error("Trained ROMs are not supported")},initHeader:function(){var flags6=this.header[6];this.mirroring=1&flags6?VERTICAL:HORIZONTAL,this.battery=2&flags6,this.trainer=4&flags6,this.mirroring=8&flags6?FOUR_SCREEN:this.mirroring;var flags7=this.header[7];this.vs=1&flags7,this.mapper=(240&flags6)>>4|240&flags7,this.pal=1&this.header[9]},initData:function(){this.prgBanks=this.header[4],this.chrBanks=this.header[5],this.ramBanks=this.header[8]||1,this.prgSize=16*this.prgBanks*1024,this.chrSize=8*this.chrBanks*1024,this.ramSize=8*this.ramBanks*1024,this.prgData=this.data.subarray(0,this.prgSize),this.chrData=this.chrBanks?this.data.subarray(this.prgSize,this.prgSize+this.chrSize):new Uint8Array(8192),this.ramData=new Uint8Array(this.ramSize),this.initMapper()},initMapper:function(){this.prgRead=new Uint8Array(32768),this.prgRead.set(this.prgData.subarray(0,8192)),this.chrRead=new Uint8Array(8192),this.chrRead.set(this.chrData.subarray(0,8192)),mappers.init(this)},writeRegister:function(){},readPRG:function(address){return 32768&address?this.prgRead[32767&address]:address>=24576?this.ramData[address-24576]:0},writePRG:function(address,value){32768&address?this.writeRegister(address,value):address>=24576&&(this.ramData[address-24576]=value)},loadPRGBank:function(address,bank,size){var offset=bank*size,bankData=this.prgData.subarray(offset,offset+size);this.prgRead.set(bankData,address-32768)},readCHR:function(address){return this.chrRead[address]},writeCHR:function(address,value){return this.chrBanks||(this.chrRead[address]=value),value},loadCHRBank:function(address,bank,size){var offset=bank*size,bankData=this.chrData.subarray(offset,offset+size);this.chrRead.set(bankData,address)},getNameTableAddress:function(address){switch(this.mirroring){case HORIZONTAL:address>=1024&&(address-=1024),address>=2048&&(address-=1024);break;case VERTICAL:address&=2047;break;case FOUR_SCREEN:throw new Error("TODO, four screen mirroring");case SINGLE_SCREEN_LOWER:case SINGLE_SCREEN_UPPER:address&=1023,4===this.mirroring&&(address+=1024)}return address},readNameTable:function(address){return this.system.ppu.ram[this.getNameTableAddress(address)]},writeNameTable:function(address,value){this.system.ppu.ram[this.getNameTableAddress(address)]=value}},module.exports=Cartridge},{"./mappers":17}],11:[function(require,module){function Controllers(system){this.system=system,this.controller0=new NoController,this.controller1=new NoController,this.controllers=new Array(CONTROLLER_COUNT),this.strobe=0}function NoController(){}const CONTROLLER_COUNT=2;Controllers.prototype={get:function(index){return index?this.controller1:this.controller0},connect:function(index,controller){index?this.controller1=controller:this.controller0=controller},read:function(index){return this.get(index).read()},write:function(value){var strobe=1&value;this.controller0.setStrobe(strobe),this.controller1.setStrobe(strobe)}},NoController.prototype={read:function(){return 0},setStrobe:function(){}},module.exports=Controllers},{}],12:[function(require,module){"use strict";function StandardController(){this.data=0,this.mask=0,this.strobe=0,Object.preventExtensions(this)}function getBitMask(button){return buttonMap[button.toLowerCase()]||0}StandardController.prototype={press:function(button){this._press(getBitMask(button))},depress:function(button){this._depress(getBitMask(button))},_press:function(bitmask){3&bitmask?this._depress(3):12&bitmask&&this._depress(12),this.data|=bitmask},_depress:function(bitmask){this.data&=~bitmask},read:function(){if(!this.mask)return 1;var result=this.data&this.mask;return this.strobe||(this.mask>>=1),+!!result},setStrobe:function(value){value&&(this.mask=128),this.strobe=value}};var buttonMap={a:128,b:64,select:32,start:16,up:8,down:4,left:2,right:1};module.exports=StandardController},{}],13:[function(require,module){function CPU(system){"use strict";function reset(){interrupt(VECTOR_RESET)}function requestNMI(){nmiRequested=!0}function requestIRQ(){irqRequested=!0}function doNMI(){interrupt(VECTOR_NMI),nmiRequested=!1}function doIRQ(){interrupt(VECTOR_IRQ),irqRequested=!1}function interrupt(vector){push((PC&HIGH)>>8),push(PC&LOW),setP(),push(P),flagI=1,PC=peekWord(vector),burn(7)}function burn(cycles){cyclesBurnt+=cycles}function tick(){cyclesBurnt-=1,cyclesBurnt>0||(cyclesBurnt=0,setP(),irqRequested&&!flagI&&doIRQ(),op=peek(PC),execute(op),nmiRequested&&doNMI(),delayInterrupt=!1)}function execute(op){switch(writeToA=0,address=983040,debugPC=PC,op){case 62:absoluteIndexedX(),ROL(),burn(7);break;case 61:absoluteIndexedX(),AND(),burn(4);break;case 133:zeroPage(),STA(),burn(3);break;case 132:zeroPage(),STY(),burn(3);break;case 40:implied(),PLP(),burn(4);break;case 41:immediate(),AND(),burn(2);break;case 248:implied(),SED(),burn(2);break;case 249:absoluteIndexedY(),SBC(),burn(4);break;case 246:zeroPageIndexedX(),INC(),burn(6);break;case 32:absolute(),JSR(),burn(6);break;case 33:indexedIndirectX(),AND(),burn(6);break;case 38:zeroPage(),ROL(),burn(5);break;case 134:zeroPage(),STX(),burn(3);break;case 36:zeroPage(),BIT(),burn(3);break;case 37:zeroPage(),AND(),burn(2);break;case 53:zeroPageIndexedX(),AND(),burn(3);break;case 54:zeroPageIndexedX(),ROL(),burn(6);break;case 49:indirectIndexedY(),AND(),burn(5);break;case 48:relative(),BMI(),burn(2);break;case 57:absoluteIndexedY(),AND(),burn(4);break;case 56:implied(),SEC(),burn(2);break;case 140:absolute(),STY(),burn(4);break;case 44:absolute(),BIT(),burn(4);break;case 253:absoluteIndexedX(),SBC(),burn(4);break;case 254:absoluteIndexedX(),INC(),burn(7);break;case 45:absolute(),AND(),burn(4);break;case 46:absolute(),ROL(),burn(6);break;case 186:implied(),TSX(),burn(2);break;case 94:absoluteIndexedX(),LSR(),burn(7);break;case 93:absoluteIndexedX(),EOR(),burn(4);break;case 64:implied(),RTI(),burn(6);break;case 65:indexedIndirectX(),EOR(),burn(6);break;case 69:zeroPage(),EOR(),burn(3);break;case 70:zeroPage(),LSR(),burn(5);break;case 72:implied(),PHA(),burn(3);break;case 73:immediate(),EOR(),burn(2);break;case 174:absolute(),LDX(),burn(4);break;case 173:absolute(),LDA(),burn(4);break;case 172:absolute(),LDY(),burn(4);break;case 170:implied(),TAX(),burn(2);break;case 74:accumulator(),LSR(),burn(2);break;case 76:absolute(),JMP(),burn(3);break;case 77:absolute(),EOR(),burn(4);break;case 78:absolute(),LSR(),burn(6);break;case 81:indirectIndexedY(),EOR(),burn(5);break;case 80:relative(),BVC(),burn(2);break;case 86:zeroPageIndexedX(),LSR(),burn(6);break;case 85:zeroPageIndexedX(),EOR(),burn(4);break;case 154:implied(),TXS(),burn(2);break;case 229:zeroPage(),SBC(),burn(3);break;case 89:absoluteIndexedY(),EOR(),burn(4);break;case 88:implied(),CLI(),burn(2);break;case 42:accumulator(),ROL(),burn(2);break;case 169:immediate(),LDA(),burn(2);break;case 168:implied(),TAY(),burn(2);break;case 166:zeroPage(),LDX(),burn(3);break;case 165:zeroPage(),LDA(),burn(3);break;case 162:immediate(),LDX(),burn(2);break;case 161:indexedIndirectX(),LDA(),burn(6);break;case 160:immediate(),LDY(),burn(2);break;case 164:zeroPage(0),LDY(),burn(3);break;case 245:zeroPageIndexedX(),SBC(),burn(4);break;case 126:absoluteIndexedX(),ROR(),burn(7);break;case 125:absoluteIndexedX(),ADC(),burn(4);break;case 240:relative(),BEQ(),burn(2);break;case 104:implied(),PLA(),burn(4);break;case 105:immediate(),ADC(),burn(2);break;case 102:zeroPage(),ROR(),burn(5);break;case 101:zeroPage(),ADC(),burn(3);break;case 96:implied(),RTS(),burn(6);break;case 97:indexedIndirectX(),ADC(),burn(6);break;case 206:absolute(),DEC(),burn(6);break;case 205:absolute(),CMP(),burn(4);break;case 184:implied(),CLV(),burn(2);break;case 185:absoluteIndexedY(),LDA(),burn(4);break;case 202:implied(),DEX(),burn(2);break;case 204:absolute(),CPY(),burn(4);break;case 176:relative(),BCS(),burn(2);break;case 177:indirectIndexedY(),LDA(),burn(5);break;case 182:zeroPageIndexedY(),LDX(),burn(4);break;case 180:zeroPageIndexedX(),LDY(),burn(4);break;case 181:zeroPageIndexedX(),LDA(),burn(4);break;case 138:implied(),TXA(),burn(2);break;case 109:absolute(),ADC(),burn(4);break;case 110:absolute(),ROR(),burn(6);break;case 108:indirect(),JMP(),burn(5);break;case 106:accumulator(),ROR(),burn(2);break;case 121:absoluteIndexedY(),ADC(),burn(4);break;case 120:implied(),SEI(),burn(2);break;case 113:indirectIndexedY(),ADC(),burn(5);break;case 112:relative(),BVS(),burn(2);break;case 117:zeroPageIndexedX(),ADC(),burn(4);break;case 118:zeroPageIndexedX(),ROR(),burn(6);break;case 197:zeroPage(),CMP(),burn(3);break;case 196:zeroPage(),CPY(),burn(3);break;case 198:zeroPage(),DEC(),burn(5);break;case 193:indexedIndirectX(),CMP(),burn(6);break;case 192:immediate(),CPY(),burn(2);break;case 188:absoluteIndexedX(),LDY(),burn(4);break;case 228:zeroPage(),CPX(),burn(3);break;case 201:immediate(),CMP(),burn(2);break;case 200:implied(),INY(),burn(2);break;case 189:absoluteIndexedX(),LDA(),burn(4);break;case 190:absoluteIndexedY(),LDX(),burn(4);break;case 241:indirectIndexedY(),SBC(),burn(5);break;case 233:immediate(),SBC(),burn(2);break;case 208:relative(),BNE(),burn(2);break;case 209:indirectIndexedY(),CMP(),burn(5);break;case 157:absoluteIndexedX(),STA(),burn(5);break;case 8:implied(),PHP(),burn(3);break;case 213:zeroPageIndexedX(),CMP(),burn(4);break;case 214:zeroPageIndexedX(),DEC(),burn(6);break;case 216:implied(),CLD(),burn(2);break;case 217:absoluteIndexedY(),CMP(),burn(4);break;case 6:zeroPage(),ASL(),burn(5);break;case 0:implied(),BRK(),burn(7);break;case 1:indexedIndirectX(),ORA(),burn(6);break;case 236:absolute(),CPX(),burn(4);break;case 5:zeroPage(),ORA(),burn(2);break;case 234:implied(),NOP(),burn(2);break;case 129:indexedIndirectX(),STA(),burn(6);break;case 238:absolute(),INC(),burn(6);break;case 237:absolute(),SBC(),burn(4);break;case 30:absoluteIndexedX(),ASL(),burn(7);break;case 29:absoluteIndexedX(),ORA(),burn(4);break;case 136:implied(),DEY(),burn(2);break;case 9:immediate(),ORA(),burn(2);break;case 141:absolute(),STA(),burn(4);break;case 142:absolute(),STX(),burn(4);break;case 225:indexedIndirectX(),SBC(),burn(6);break;case 224:immediate(),CPX(),burn(2);break;case 230:zeroPage(),INC(),burn(5);break;case 25:absoluteIndexedY(),ORA(),burn(4);break;case 24:implied(),CLC(),burn(2);break;case 22:zeroPageIndexedX(),ASL(),burn(6);break;case 21:zeroPageIndexedX(),ORA(),burn(3);break;case 232:implied(),INX(),burn(2);break;case 17:indirectIndexedY(),ORA(),burn(5);break;case 16:relative(),BPL(),burn(2);break;case 150:zeroPageIndexedY(),STX(),burn(4);break;case 149:zeroPageIndexedX(),STA(),burn(4);break;case 148:zeroPageIndexedX(),STY(),burn(4);break;case 221:absoluteIndexedX(),CMP(),burn(4);break;case 222:absoluteIndexedX(),DEC(),burn(7);break;case 145:indirectIndexedY(),STA(),burn(6);break;case 144:relative(),BCC(),burn(2);break;case 13:absolute(),ORA(),burn(4);break;case 14:absolute(),ASL(),burn(6);break;case 10:accumulator(),ASL(),burn(2);break;case 153:absoluteIndexedY(),STA(),burn(5);break;case 152:implied(),TYA(),burn(2);break;default:PC+=1}}function read(){if(!writeToA&&983040===address)throw new Error("invalid read");return writeToA?A:peek(address)}function modRead(){return write(read())}function write(value){if(writeToA?writeA(value):poke(address,value),value>255)throw new Error("invalid write");return value}function writeA(value){A=value}function implied(){PC+=1}function accumulator(){writeToA=1,PC+=1}function immediate(){address=PC+1,PC+=2}function relative(){address=PC+1,PC+=2}function absolute(){var high=peek(PC+2)<<8,low=peek(PC+1);address=high|low,PC+=3}function zeroPage(index){var base=peek(PC+1);index=index||0,address=base+index&255,PC+=2}function absoluteIndexed(index){var high=peek(PC+2)<<8,low=peek(PC+1),base=high|low;address=base+index&65535,low+X&65280&&burn(1),PC+=3}function absoluteIndexedX(){absoluteIndexed(X)}function absoluteIndexedY(){absoluteIndexed(Y)}function zeroPageIndexedX(){zeroPage(X)}function zeroPageIndexedY(){zeroPage(Y)}function indirect(){var lowAddress=peekWord(PC+1),highAddress=lowAddress+1,low=0,high=0;255===(255&lowAddress)&&(highAddress=lowAddress-255),low=peek(lowAddress),high=peek(highAddress)<<8,address=high|low,PC+=3}function indexedIndirectX(){var peeked=peek(PC+1),newAddress=peeked+X,low=peek(255&newAddress),high=peek(newAddress+1&255)<<8;address=high|low,(65280&peeked)!==(65280&newAddress)&&burn(1),PC+=2}function indirectIndexedY(){var newAddress=peek(PC+1),low=peek(newAddress),high=peek(newAddress+1&255)<<8;address=(high|low)+Y&65535,PC+=2}function ADC(){doADC(read())}function doADC(value){var t=A+value+flagC;flagV=!!((A^t)&(value^t)&128)&&1,flagN=!!(128&t),flagC=t>255,flagZ=!(255&t),writeA(255&t)}function AND(){var value=read();4===value&&(value=value),writeA(A&value),flagN=128&A&&1,flagZ=+(0===A)}function ASL(){var value=modRead(),result=write(value<<1&254);flagC=128&value&&1,flagN=128&result&&1,flagZ=+(0===result)}function BCS(){branch(flagC)}function BCC(){branch(!flagC)}function BEQ(){branch(flagZ)}function BNE(){branch(!flagZ)}function BMI(){branch(flagN)}function BPL(){branch(!flagN)}function BVS(){branch(flagV)}function BVC(){branch(!flagV)}function branch(flag){var offset=read(),prevHigh=PC&HIGH,curHigh=0;flag&&(burn(1),128&offset&&(offset=-complement(offset)),PC+=offset,curHigh=PC&HIGH,prevHigh!==curHigh&&burn(1))}function BIT(){var value=read(),t=A&value;flagN=128&value&&1,flagV=64&value&&1,flagZ=+(0===t)}function BRK(){var high,low;PC+=1,push((PC&HIGH)>>8),push(PC&LOW),setP(),push(16|P),low=peek(65534),high=peek(65535)<<8,PC=high|low}function CLC(){flagC=0}function CLD(){flagD=0}function CLI(){flagI=0,delayInterrupt=!0}function CLV(){flagV=0}function CMP(){xCMP(A)}function CPX(){xCMP(X)}function CPY(){xCMP(Y)}function xCMP(value){var readValue=read(),t=value-readValue&255;flagN=128&t&&1,flagC=+(value>=readValue),flagZ=+(0===t)}function DEC(){var result=write(modRead()-1&255);flagN=+!!(128&result),flagZ=+(0===result)}function DEX(){X=X-1&255,flagZ=+(0===X),flagN=128&X&&1}function DEY(){Y=Y-1&255,flagZ=+(0===Y),flagN=128&Y&&1}function EOR(){writeA(A^read()),flagN=128&A&&1,flagZ=+(0===A)}function INC(){var result=write(modRead()+1&255);flagN=!!(128&result),flagZ=0===result}function INX(){X=X+1&255,flagN=128&X&&1,flagZ=+(0===X)}function INY(){Y=Y+1&255,flagN=128&Y&&1,flagZ=+(0===Y)}function JMP(){PC=address}function JSR(){var t=PC-1;push((t&HIGH)>>8),push(t&LOW),PC=address}function LDA(){var value=read();writeA(value),flagN=128&A&&1,flagZ=+(0===A)}function LDX(){X=read(),flagN=128&X&&1,flagZ=+(0===X)}function LDY(){Y=read(),flagN=128&Y&&1,flagZ=+(0===Y)}function LSR(){var value=modRead();flagN=0,flagC=1&value&&1;var result=write(value>>>1&255);flagZ=+(0===result)}function NOP(){}function ORA(){writeA(A|read()),flagN=128&A&&1,flagZ=+(0===A)}function PHA(){push(A)}function PHP(){setP(),push(16|P)}function PLA(){writeA(pop()),flagN=128&A&&1,flagZ=+(0===A)}function PLP(){P=pop(),setFlags()}function ROL(){var value=modRead(),result=value<<1&254;result=write(result|flagC),flagC=128&value&&1,flagZ=+(0===result),flagN=128&result&&1}function ROR(){var value=modRead(),result=value>>>1&255;result=write(result|(flagC?128:0)),flagC=1&value,flagZ=+(0===result),flagN=128&result&&1}function RTI(){var low,high;P=pop(),setFlags(),low=pop(),high=pop()<<8,PC=high|low}function RTS(){var low,high;low=pop(),high=pop()<<8,PC=(high|low)+1}function SBC(){doADC(255^read())}function SEC(){flagC=1}function SED(){flagD=1}function SEI(){flagI=1}function STA(){write(A)}function STX(){write(X)}function STY(){write(Y)}function TAX(){X=A,flagN=128&X&&1,flagZ=+(0===X)}function TAY(){Y=A,flagN=128&Y&&1,flagZ=+(0===Y)}function TSX(){X=SP,flagN=128&X&&1,flagZ=+(0===X)}function TXA(){writeA(X),flagN=128&A&&1,flagZ=+(0===A)}function TXS(){SP=X}function TYA(){writeA(Y),flagN=128&A&&1,flagZ=+(0===A)}function poke(index,value){system.memory.write(index,value)}function peek(index){return system.memory.read(index)}function peekWord(index){var low=peek(index),high=peek(index+1&65535)<<8;return low|high}function pop(){SP=SP+1&255;var result=peek(256|SP);return result}function push(value){poke(256|SP,value),SP=SP-1&255}function complement(value){return(255&~value)+1}function setFlags(){flagN=!!(128&P),flagV=!!(64&P),flagB=!!(16&P),flagD=!!(8&P),flagI=!!(4&P),flagZ=!!(2&P),flagC=!!(1&P)}function setP(){P=flagN<<7|flagV<<6|32|flagB<<4|flagD<<3|flagI<<2|flagZ<<1|flagC}function setPC(value){PC=value}function resetCycles(){cyclesBurnt=0}function getCycles(){return cyclesBurnt}var address,writeToA,op,cyclesBurnt=0,A=0,X=0,Y=0,SP=0,PC=32768,P=0,debugPC=PC,delayInterrupt=!1,flagI=!1,flagB=!0,flagC=!1,flagN=!0,flagD=!1,flagV=!1,flagZ=!1,irqRequested=!1,nmiRequested=!1,LOW=255,HIGH=65280;const VECTOR_NMI=65530,VECTOR_RESET=65532,VECTOR_IRQ=65534;this.burn=burn,this.reset=reset,this.tick=tick,this.setPC=setPC,this.requestNMI=requestNMI,this.requestIRQ=requestIRQ,this.getCycles=getCycles,this.resetCycles=resetCycles,this.execute=execute}module.exports=CPU},{}],14:[function(require,module){function Input(system){this.system=system,this.controllers=system.controllers,this.inputHandlers=new Array(2),this.initConfig(),this.enable()}var Keyboard=require("./keyboard"),StandardController=require("../controllers/standardcontroller");Input.prototype={enable:function(){this._setEnabled(!0)},disable:function(){this._setEnabled(!1)},_setEnabled:function(enabled){for(var handler,method=enabled?"enable":"disable",i=0;i<this.inputHandlers.length;i++)handler=this.inputHandlers[i],handler&&handler[method]()},initConfig:function(){for(var item,config=this.config=this.system.config.input,i=0;i<config.length;i++)item=config[i],this.setController(i,item.type),this.setInputHandler(i,item.input,item.config);

},setController:function(index,type){var Controller=controllerMap[type];this.controllers.connect(index,new Controller)},setInputHandler:function(index,input,config){var InputHandler=inputHandlerMap[input],controller=this.controllers.get(index);this.inputHandlers[index]=new InputHandler(controller,config)}};var controllerMap={standard:StandardController},inputHandlerMap={keyboard:Keyboard};module.exports=Input},{"../controllers/standardcontroller":12,"./keyboard":15}],15:[function(require,module){function Keyboard(controller,config){this.controller=controller,this.handlers={},config&&this.configure(config),this.enabled=!1}Keyboard.prototype={configure:function(config){this.config=config,this.initKeyCodes()},enable:function(){this.enabled||(this.bindHandler("keydown"),this.bindHandler("keyup")),this.enabled=!0},disable:function(){this.unbindHandler("keydown"),this.unbindHandler("keyup"),this.enabled=!1},bindHandler:function(type){window.addEventListener(type,this.getHandler(type))},unbindHandler:function(type){window.removeEventListener(type,this.getHandler(type))},getHandler:function(type){if(this.handlers[type])return this.handlers[type];var self=this,handler="keydown"===type?"press":"depress";return this.handlers[type]=function(e){var keyCode=e.keyCode;keyCode in self.keyCodes&&(self.controller[handler](self.keyCodes[keyCode]),e.preventDefault())},this.handlers[type]},initKeyCodes:function(){var name,keyCode,keyCodes={};for(name in this.config)keyCode=name in keyCodeMap?keyCodeMap[name]:name.toUpperCase().charCodeAt(),keyCodes[keyCode]=this.config[name];this.keyCodes=keyCodes}};var keyCodeMap={backspace:8,tab:9,"return":13,shift:16,ctrl:17,alt:18,capslock:20,space:32,left:37,up:38,right:39,down:40};module.exports=Keyboard},{}],16:[function(require,module){module.exports={init:function(){this.axRomBanks=this.prgBanks>>1,this.setPrgBank(0)},setPrgBank:function(bank){this.prgBank=bank,this.loadPRGBank(32768,bank,32768)},writeRegister:function(address,value){this.setPrgBank(7&value),this.mirroring=16&value?4:3}}},{}],17:[function(require,module,exports){var NROM=require("./nrom"),MMC1=require("./mmc1"),MMC2=require("./mmc2"),MMC3=require("./mmc3"),UxROM=require("./uxrom"),AxROM=require("./axrom"),mapperList={};mapperList[0]=NROM,mapperList[1]=MMC1,mapperList[2]=UxROM,mapperList[4]=MMC3,mapperList[7]=AxROM,mapperList[9]=MMC2,exports.init=function(cartridge){var mapper,method,mapperID=cartridge.mapper;if(!(mapperID in mapperList))throw new Error("Unknown mapper "+mapperID);mapper=mapperList[mapperID];for(method in mapper)cartridge[method]=mapper[method];cartridge.init()}},{"./axrom":16,"./mmc1":18,"./mmc2":19,"./mmc3":20,"./nrom":21,"./uxrom":22}],18:[function(require,module){var mirrorMap=[3,4,1,0];module.exports={init:function(){this.lastPRG=this.prgBanks-1,this.prgBank=0,this.chrBank0=0,this.chrBank1=1,this.registerWrites=0,this.registerShift=0,this.mapperControl(12)},mapperControl:function(value){var mirroring=3&value,prgMode=(12&value)>>2,chrMode=(16&value)>>4;this.mapperFlags=value,this.mirroring=mirrorMap[mirroring],this.prgMode=prgMode,this.chrMode=chrMode,this.setPRGBanks()},setRegister:function(address,value){switch(24576&address){case 0:this.mapperControl(value);break;case 8192:this.chrBank0=value,this.setChrBanks();break;case 16384:this.chrBank1=value,this.setChrBanks();break;case 24576:value&=15,this.prgBank=value,this.setPRGBanks()}this.registerWrites=0,this.registerShift=0},setPRGBanks:function(){var bank0,bank1;switch(this.prgMode){case 0:case 1:bank0=-2&this.prgBank,bank1=this.prgBank+1;break;case 2:bank0=0,bank1=this.prgBank;break;case 3:bank0=this.prgBank,bank1=this.lastPRG}this.loadPRGBank(32768,bank0,16384),this.loadPRGBank(49152,bank1,16384)},setChrBanks:function(){var bank0,bank1;this.chrMode?(bank0=this.chrBank0,bank1=this.chrBank1,this.chrBanks<2&&(bank0&=1,bank1&=1)):(bank0=-2&this.chrBank0,bank1=bank0+1),this.loadCHRBank(0,bank0,4096),this.loadCHRBank(4096,bank1,4096)},writeRegister:function(address,value){128&value?(this.registerShift=0,this.registerWrites=0,this.mapperControl(12|this.mapperFlags)):(this.registerShift=this.registerShift>>1|(1&value)<<4,this.registerWrites++,5===this.registerWrites&&this.setRegister(address,this.registerShift))}}},{}],19:[function(require,module){module.exports={init:function(){this.setPrgBank(0),this.mmc2PRG=this.prgBanks<<1,this.loadPRGBank(40960,this.mmc2PRG-3,8192),this.loadPRGBank(49152,this.mmc2PRG-2,8192),this.loadPRGBank(57344,this.mmc2PRG-1,8192),this.chrLatch0=!1,this.chrLatch1=!1,this.chrBank0=this.chrBank1=0,this.chrBank2=this.chrBank3=0,this.chrBankA=this.chrBank0,this.chrBankB=this.chrBank1,this.setChrBanks(),this.initLatchSwitches(),this._readCHR=Object.getPrototypeOf(this).readCHR},initLatchSwitches:function(){var i,switches=new Uint8Array(8192);for(switches[4056]=1,switches[4072]=2,i=8152;8160>i;i++)switches[i]=3;for(i=8168;8176>i;i++)switches[i]=4;this.latchSwitches=switches},setChrBanks:function(){var bank0=this.chrLatch0?this.chrBank1:this.chrBank0,bank1=this.chrLatch1?this.chrBank3:this.chrBank2;this.loadCHRBank(0,bank0,4096),this.loadCHRBank(4096,bank1,4096)},setPrgBank:function(bank){this.prgBank=bank,this.loadPRGBank(32768,this.prgBank,8192)},writeRegister:function(address,value){switch(28672&address){case 8192:this.setPrgBank(15&value);break;case 12288:this.chrBank0=31&value;break;case 16384:this.chrBank1=31&value;break;case 20480:this.chrBank2=31&value;break;case 24576:this.chrBank3=31&value;break;case 28672:this.mirroring=+!(1&value)}this.setChrBanks()},readCHR:function(address){var value=this._readCHR(address);switch(this.latchSwitches[address]){case 0:break;case 1:this.chrLatch0&&(this.chrLatch0=!1,this.setChrBanks());break;case 2:this.chrLatch0||(this.chrLatch0=!0,this.setChrBanks());break;case 3:this.chrLatch1&&(this.chrLatch1=!1,this.setChrBanks());break;case 4:this.chrLatch1||(this.chrLatch1=!0,this.setChrBanks())}return value}}},{}],20:[function(require,module){module.exports={init:function(){this.lastA14=0,this.irqEnabled=!1,this.irqCounter=0,this.irqCounterReset=0,this.willReloadIRQ=!1,this.prgBank0=0,this.prgBank1=1,this.prgBase0=32768,this.prgBase1=40960,this.mmc3PRG=this.prgBanks<<1,this.lastPRG=this.mmc3PRG-1,this.lastPRG2=this.lastPRG-1,this.mmc3CHR=this.chrBanks<<3,this.setBankSelect(0),this._readCHR=Object.getPrototypeOf(this).readCHR},setBankSelect:function(value){var prgMode=+!!(64&value),chrMode=+!!(128&value);this.bankSelectMode=7&value,prgMode!==this.prgMode&&this.setPRGMode(prgMode),chrMode!==this.chrMode&&this.setCHRMode(chrMode)},setPRGMode:function(mode){this.prgMode=mode,mode?(this.loadPRGBank(32768,this.lastPRG2,8192),this.prgBase0=49152):(this.loadPRGBank(49152,this.lastPRG2,8192),this.prgBase0=32768),this.loadPRGBank(57344,this.lastPRG,8192),this.prgBase1=40960,this.setPRGBanks()},setBank:function(value){var bank=0,base=0;switch(this.bankSelectMode){case 1:bank=1;case 0:base=this.chrBigBase+2048*bank,this.loadCHRBank(base,-2&value,1024),this.loadCHRBank(base+1024,1|value,1024);break;case 2:case 3:case 4:case 5:bank=this.bankSelectMode-2,base=this.chrSmallBase+1024*bank,this.loadCHRBank(base,value,1024);break;case 6:this.prgBank0=value&this.mmc3PRG-1,this.setPRGBanks();break;case 7:this.prgBank1=value&this.mmc3PRG-1,this.setPRGBanks()}},setPRGBanks:function(){this.loadPRGBank(this.prgBase0,this.prgBank0,8192),this.loadPRGBank(this.prgBase1,this.prgBank1,8192)},setCHRMode:function(mode){this.chrMode=mode,mode?(this.chrBigBase=4096,this.chrSmallBase=0):(this.chrBigBase=0,this.chrSmallBase=4096)},setMirroring:function(value){this.mirroring=+!(1&value)},setRAMProtect:function(){},reloadIRQ:function(){this.willReloadIRQ=!0},setIRQCounter:function(value){this.irqCounterReset=value},enableIRQ:function(enabled){this.irqEnabled=enabled},writeRegister:function(address,value){var odd=1&address;switch(24576&address){case 0:odd?this.setBank(value):this.setBankSelect(value);break;case 8192:odd?this.setRAMProtect(value):this.setMirroring(value);break;case 16384:odd?this.reloadIRQ():this.setIRQCounter(value);break;case 24576:this.enableIRQ(!!odd)}},readCHR:function(address){var a14=4096&address;return a14&&a14!==this.lastA14&&this.clockScanlineCounter(),this.lastA14=a14,this._readCHR(address)},clockScanlineCounter:function(){this.willReloadIRQ||!this.irqCounter?(this.irqCounter=this.irqCounterReset,this.willReloadIRQ=!1):(this.irqCounter--,!this.irqCounter&&this.irqEnabled&&this.system.cpu.requestIRQ())}}},{}],21:[function(require,module){module.exports={init:function(){var nrom128=1===this.prgBanks;nrom128?(this.loadPRGBank(32768,0,16384),this.loadPRGBank(49152,0,16384)):this.loadPRGBank(32768,0,32768)},readCHR:function(address){return this.chrData[address]},writeCHR:function(address,value){return this.chrBanks||(this.chrData[address]=value),value}}},{}],22:[function(require,module){module.exports={init:function(){this.prgBank=0,this.loadPRGBank(32768,this.prgBank,16384),this.loadPRGBank(49152,this.prgBanks-1,16384)},writeRegister:function(address,value){this.prgBank=15&value,this.loadPRGBank(32768,this.prgBank,16384)}}},{}],23:[function(require,module){"use strict";function Memory(system){var i=0;for(this.system=system,this.ram=new Uint8Array(2048);2048>i;i++)this.ram[i]=255;this.address=0,Object.preventExtensions(this)}Memory.prototype={readWrite:function(address,write,value){switch(this.address=address,address){case 16404:if(write){var i,base=value<<8;for(i=0;256>i;i++)this.write(8196,this.read(base+i));this.system.cpu.burn(513)}return 0;case 16406:return write?(this.system.controllers.write(value),0):this.system.controllers.read(0);case 16407:if(!write)return this.system.controllers.read(1)}return address>=16416?write?this.system.cartridge.writePRG(address,value):this.system.cartridge.readPRG(address):8192>address?(address&=2047,write?(this.ram[address]=value,0):this.ram[address]):16384>address?(address&=7,write?this.system.ppu.writeRegister(address,value):this.system.ppu.readRegister(address)):(address&=255,write?this.system.apu.writeRegister(address,value):this.system.apu.readRegister(address))},read:function(address){return this.readWrite(address,!1,0)},write:function(address,value){return this.readWrite(address,!0,value)}},module.exports=Memory},{}],24:[function(require,module){function AudioOutput(){this.bufferIndex=0,this.bufferLength=8192,this.sampleRate=44100,this.volume=1,this.playing=null,this.setEnabled(!0)}AudioOutput.prototype={writeSample:function(sample){this.bufferData[this.bufferIndex++]=sample,this.bufferIndex===this.bufferLength&&(this.bufferIndex=0,this.playing&&this.playing.stop(),this.bufferSource.buffer=this.buffer,this.playing=this.bufferSource,this.playing.start(0),this.initBuffer())},setEnabled:function(enabled){this.enabled=enabled&&this.isSupported(),this.enabled&&(this.initContext(),this.initBuffer())},setVolume:function(value){this.gainNode.gain.value=value,this.volume=value},initContext:function(){this.context=new AudioContext,this.sampleRate=this.context.sampleRate,this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination)},initBuffer:function(){this.buffer=this.context.createBuffer(1,this.bufferLength,this.context.sampleRate),this.bufferData=this.buffer.getChannelData(0),this.bufferSource=this.context.createBufferSource(),this.bufferSource.connect(this.gainNode)},isSupported:function(){return"undefined"!=typeof AudioContext}},module.exports=AudioOutput},{}],25:[function(require,module){function Output(){this.audio=new AudioOutput,this.video=new VideoOutput}var AudioOutput=require("./audiooutput"),VideoOutput=require("./videooutput");module.exports=Output},{"./audiooutput":24,"./videooutput":27}],26:[function(require,module,exports){exports.data=new Uint8Array([102,102,102,0,42,136,20,18,167,59,0,164,92,0,126,110,0,64,108,7,0,86,29,0,51,53,0,12,72,0,0,82,0,0,79,8,0,64,77,0,0,0,0,0,0,0,0,0,173,173,173,21,95,217,66,64,255,117,39,254,160,26,204,183,30,123,181,49,32,153,78,0,107,109,0,56,135,0,13,147,0,0,143,50,0,124,141,0,0,0,0,0,0,0,0,0,255,255,255,100,176,255,146,144,255,198,118,255,242,106,255,255,110,204,255,129,112,234,158,34,188,190,0,136,216,0,92,228,48,69,224,130,72,205,222,79,79,79,0,0,0,0,0,0,255,255,255,192,223,255,211,210,255,232,200,255,250,194,255,255,196,234,255,204,197,247,216,165,228,229,148,207,239,150,189,244,171,179,243,204,181,235,242,184,184,184,0,0,0,0,0,0])},{}],27:[function(require,module){function VideoOutput(){this.initData(),this.initPalette()}var palette=require("./palette");VideoOutput.prototype={setElement:function(el){this.el=el},run:function(){var el=this.el,context=el.getContext("2d"),image=context.getImageData(0,0,256,240),imageData=image.data,myData=this.data;requestAnimationFrame(function flush(){imageData.set(myData),context.putImageData(image,0,0),requestAnimationFrame(flush)})},reset:function(){this.index=0},setIntensity:function(){},setGrayscale:function(){},outputPixel:function(color){this.data[this.index]=this.reds[color],this.data[this.index+1]=this.greens[color],this.data[this.index+2]=this.blues[color],this.index+=4},initData:function(){this.width=256,this.height=224,this.data=new Uint8Array(this.width*this.height*4);for(var i=0;i<this.data.length;i++)this.data[i]=255;this.index=0},initPalette:function(){var color=0,i=0,address=0,view=palette.data,buffer=new ArrayBuffer(192),splitPalette=new Uint8Array(buffer);for(color=0;3>color;color+=1)for(i=0;192>i;i+=3)splitPalette[address]=view[i+color],address+=1;this.palette=view,this.reds=new Uint8Array(buffer,0,64),this.greens=new Uint8Array(buffer,64,64),this.blues=new Uint8Array(buffer,128,64)}},module.exports=VideoOutput},{"./palette":26}],28:[function(require,module){"use strict";function Background(ppu){this.ppu=ppu,this.memory=ppu.memory,this.enabled=!0,this.enabledLeft=!0,this.enabledPixel=!1,this.loopyV=0,this.loopyT=0,this.loopyW=0,this.loopyX=0,this.baseTable=0,this.copyingVertical=!1,this.fetchingTiles=!1,this.x=0,this.scanlineColors=new Uint8Array(512),this.palette=0,this.tileLow=0,this.tileHigh=0,this.tileMask=0,Object.preventExtensions(this)}const NAMETABLE_RESET=-3073;Background.prototype={toggle:function(flag){this.enabled=!!flag},toggleLeft:function(flag){this.enabledLeft=!!flag},writeAddress:function(value){this.loopyW?(value&=255,this.loopyT=65280&this.loopyT|value,this.loopyV=this.loopyT):(value&=63,value<<=8,this.loopyT=255&this.loopyT|value),this.loopyW=!this.loopyW},writeScroll:function(value){this.loopyW?(this.loopyT=-29665&this.loopyT,this.loopyT=this.loopyT|(7&value)<<12,this.loopyT=this.loopyT|(248&value)<<2,this.loopyW=0):(this.loopyT=32736&this.loopyT,this.loopyT|=value>>3,this.loopyX=7&value,this.loopyW=1)},evaluate:function(){if(this.initLineCycle(),this.fetchingTiles&&this.fetchTileData(),this.ppu.enabled){switch(this.ppu.lineCycle){case 256:this.incrementVY();break;case 257:this.loopyV=31712&this.loopyV|1055&this.loopyT}this.copyingVertical&&(this.loopyV=1055&this.loopyV|31712&this.loopyT)}},initLineCycle:function(){switch(this.ppu.lineCycle){case 1:this.enabledPixel=this.enabledLeft&&this.ppu.inLeft8px,this.fetchingTiles=!0;break;case 321:this.x=-this.loopyX-8,this.fetchingTiles=!0;break;case 9:this.enabledPixel=this.ppu.enabled;break;case 257:case 337:this.fetchingTiles=!1;break;case 281:-1===this.ppu.scanline&&(this.copyingVertical=!0);break;case 304:-1===this.ppu.scanline&&(this.copyingVertical=!1)}},incrementVX:function(){31===(31&this.loopyV)?(this.loopyV&=65504,this.loopyV^=1024):this.loopyV+=1},incrementVY:function(){if(28672!=(28672&this.loopyV))this.loopyV+=4096;else{this.loopyV&=-28673;var coarseY=(992&this.loopyV)>>>5;29==coarseY?(coarseY=0,this.loopyV^=2048):31==coarseY?coarseY=0:coarseY+=1,this.loopyV=-993&this.loopyV|coarseY<<5}},setPixel:function(){var color=this.scanlineColors[this.ppu.lineCycle-1];return this.enabledPixel||(color=0),color},fetchTileData:function(){if(this.setColor(),!(7&this.ppu.lineCycle)&&this.ppu.enabled){const nametableAddress=8192|4095&this.loopyV,attrAddress=9152|3072&this.loopyV|this.loopyV>>4&56|this.loopyV>>2&7,nameTableByte=this.memory.read(nametableAddress),attribute=this.memory.read(attrAddress),fineY=(28672&this.loopyV)>>12,tileAddress=(nameTableByte<<4)+this.baseTable+fineY,bitmapLow=this.memory.read(tileAddress),bitmapHigh=this.memory.read(tileAddress+8);var paletteMask=3,paletteShift=0,palette=0;2&nametableAddress&&(paletteMask<<=2,paletteShift=2),64&nametableAddress&&(paletteMask<<=4,paletteShift+=4),palette=(attribute&paletteMask)>>paletteShift,this.palette=palette<<2,this.tileLow=bitmapLow,this.tileHigh=bitmapHigh,this.tileMask=128,this.incrementVX()}},setColor:function(){const low=!!(this.tileLow&this.tileMask),high=!!(this.tileHigh&this.tileMask)<<1,color=high|low;this.scanlineColors[511&this.x++]=color&&this.palette|color,this.tileMask>>=1},setNameTable:function(index){this.loopyT=this.loopyT&NAMETABLE_RESET|index<<10}},module.exports=Background},{}],29:[function(require,module){"use strict";function PPU(system){this.system=system,this.ram=new Uint8Array(2048),this.enabled=!0,this.vBlank=!1,this.warmup=2,this.scanline=-1,this.lineCycle=0,this.increment=1,this.masterSlave=0,this.generateNMI=!1,this.sprite0Hit=!1,this.nmiOccurred=!1,this.checkNMI=!1,this.pixelInRange=!1,this.yInRange=!1,this.inRenderScanline=!0,this.inLeft8px=!1,this.readBuffer=0,this.memory=new Memory(this),this.background=new Background(this),this.sprites=new Sprites(this),this.output=this.system.output.video,Object.preventExtensions(this)}var Background=require("./background"),Sprites=require("./sprites"),Memory=require("./memory");PPU.prototype={readStatus:function(){var result=!!this.nmiOccurred<<7|!!this.sprite0Hit<<6|!!this.sprites.spriteOverflow<<5;return this.nmiOccurred=!1,result},mask:function(value){this.output.setGrayscale(1&value),this.output.setIntensity(32&value,64&value,128&value),this.sprites.toggle(16&value),this.sprites.toggleLeft(4&value),this.background.toggle(8&value),this.background.toggleLeft(2&value),this.enabled=this.sprites.enabled||this.background.enabled},control:function(value){var nametableFlag=3&value,incrementFlag=4&value,spriteFlag=8&value,backgroundFlag=16&value,sizeFlag=32&value,nmiFlag=128&value;this.background.setNameTable(nametableFlag),this.increment=incrementFlag?32:1,this.sprites.baseTable=spriteFlag?4096:0,this.background.baseTable=backgroundFlag?4096:0,this.sprites.spriteSize=sizeFlag?16:8,this.generateNMI=!!nmiFlag},readRegister:function(address){var result;switch(address){case 2:return result=this.readStatus(),this.background.loopyW=0,result;case 4:return this.sprites.readOAM();case 7:return result=this.readBuffer,this.readBuffer=this.memory.read(this.background.loopyV),16128===(16128&this.background.loopyV)&&(result=this.readBuffer,this.readBuffer=this.memory.read(12287&this.background.loopyV)),this.background.loopyV+=this.increment,result}},writeRegister:function(address,value){switch(address){case 0:this.control(value);break;case 1:this.mask(value);break;case 3:this.sprites.oamAddress=value;break;case 4:this.sprites.writeOAM(value);break;case 5:this.background.writeScroll(value);break;case 6:this.background.writeAddress(value);break;case 7:this.memory.write(this.background.loopyV,value),this.background.loopyV+=this.increment}},tick:function(){this.inRenderScanline&&(this.background.evaluate(),this.sprites.evaluate(),this.pixelInRange&&this.drawPixel()),this.incrementLineCycle()},incrementLineCycle:function(){switch(this.lineCycle++,this.lineCycle){case 1:switch(this.pixelInRange=this.yInRange,this.inLeft8px=!0,this.scanline){case-1:this.vBlank=this.nmiOccurred=!1,this.checkNMI=!1,this.sprites.spriteOverflow=!1,this.sprite0Hit=!1;break;case 241:this.warmup?this.warmup--:(this.vBlank=this.nmiOccurred=this.checkNMI=!0,this.generateNMI&&this.system.cpu.requestNMI())}break;case 9:this.inLeft8px=!1;break;case 257:this.pixelInRange=!1;break;case 341:this.incrementScanline()}},incrementScanline:function(){switch(this.scanline++,this.lineCycle=0,this.scanline){case 8:this.output.reset(),this.yInRange=!0;break;case 233:this.yInRange=!1;break;case 240:this.inRenderScanline=!1;break;case 261:this.scanline=-1,this.system.frameEnded=!0,this.inRenderScanline=!0}},drawPixel:function(){var color=this.background.setPixel();color=this.sprites.setPixel(color),this.output.outputPixel(this.memory.palette[color])}},module.exports=PPU},{"./background":28,"./memory":30,"./sprites":31}],30:[function(require,module){function Memory(ppu){this.ppu=ppu,this.system=ppu.system,this.palette=new Uint8Array(32)}Memory.prototype={read:function(address){return this._readWrite(address,0,0)},write:function(address,value){this._readWrite(address,value,1)},_readWrite:function(address,value,write){var relativeAddress=0;return address&=16383,-8192&address?-12288&address?16128>address?this._readWrite(address-4096,value,write):16383>address?(relativeAddress=31&address,0===(3&relativeAddress)&&(relativeAddress&=-17),write?(this.palette[relativeAddress]=value,0):this.palette[relativeAddress]):void 0:(relativeAddress=8191&address,write?(this.system.cartridge.writeNameTable(relativeAddress,value),0):this.system.cartridge.readNameTable(relativeAddress)):write?this.system.cartridge.writeCHR(address,value):this.system.cartridge.readCHR(address)}},module.exports=Memory},{}],31:[function(require,module){"use strict";function Sprites(ppu){this.ppu=ppu,this.memory=ppu.memory,this.enabled=!0,this.enabledLeft=!0,this.oamAddress=0,this.oam=new Uint8Array(256),this.oam2=new Uint8Array(33),this.oam2reset=new Uint8Array(this.oam2.length);for(var i=0;i<this.oam2reset.length;i++)this.oam2reset[i]=255;this.spriteProgress=0,this.currentSprite=0,this.spriteSize=8,this.baseTable=0,this.clearProgress=0,this.n=0,this.m=0,this.oam2Index=0,this.oamInitDone=0,this.sprite0Next=!1,this.sprite0InRange=!1,this.spriteOverflow=!1,this.scanlineOverflow=!1,this.spriteCount=0,this.nextSpriteCount=0,this.yCounters=new Uint8Array(64),this.yCountersReset=new Uint8Array(this.yCounters.length),this.oddPixel=!0,this.nextScanlineSprite0=new Uint8Array(256),this.nextScanlinePriority=new Uint8Array(256),this.nextScanlineColors=new Uint8Array(256),this.scanlineSprite0=new Uint8Array(256),this.scanlinePriority=new Uint8Array(256),this.scanlineColors=new Uint8Array(256),this.scanlineReset=new Uint8Array(this.scanlineColors.length),Object.preventExtensions(this)}var bitwise=require("../utils/bitwise");Sprites.prototype={toggle:function(flag){this.enabled=!!flag},toggleLeft:function(flag){this.enabledLeft=!!flag},evaluate:function(){var lineCycle=this.ppu.lineCycle;0===lineCycle?(this.n=0,this.m=0,this.oamInitDone=0,this.currentSprite=0,this.oam2Index=0,this.sprite0InRange=this.sprite0Next,this.sprite0Next=!1,this.scanlineOverflow=!1,this.oddPixel=!0,this.oamAddress=0,this.clearSecondaryOAM(),this.scanlineSprite0.set(this.nextScanlineSprite0),this.scanlinePriority.set(this.nextScanlinePriority),this.scanlineColors.set(this.nextScanlineColors),this.nextSpriteCount&&(this.nextScanlineSprite0.set(this.scanlineReset),this.nextScanlinePriority.set(this.scanlineReset),this.nextScanlineColors.set(this.scanlineReset)),this.spriteCount=this.nextSpriteCount,this.nextSpriteCount=0):64>=lineCycle||(256>=lineCycle?this.initSecondaryOAM():320>=lineCycle&&this.fetchSprites())},readOAM:function(){return this.ppu.vBlank?this.oam[this.oamAddress]:0},writeOAM:function(value){this.ppu.vBlank&&(this.oam[this.oamAddress]=value,this.oamAddress=this.oamAddress+1&255)},clearSecondaryOAM:function(){this.oam2.set(this.oam2reset),-1===this.ppu.scanline&&this.yCounters.set(this.yCountersReset)},initSecondaryOAM:function(){if(this.ppu.enabled){if(64===this.n)return void(this.oam2[this.oam2Index]=0);var index=this.oamAddress,value=this.oam[index];this.oam2[this.oam2Index]=value,this.ppu.scanline===value&&(this.yCounters[this.n]=this.spriteSize),this.yCounters[this.n]&&(this.scanlineOverflow?this.spriteOverflow=!0:(this.oam2.set(this.oam.subarray(index,index+4),this.oam2Index),0===this.n&&(this.sprite0Next=!0),this.nextSpriteCount++,this.oam2Index+=4,32===this.oam2Index&&(this.scanlineOverflow=!0)),this.yCounters[this.n]--),this.oamAddress+=4,this.n++}},fetchSprites:function(){if(this.ppu.enabled&&7===this.spriteProgress){var spriteIndex=this.currentSprite<<2,y=this.oam2[spriteIndex],tileIndex=this.oam2[spriteIndex+1],attributes=this.oam2[spriteIndex+2],x=this.oam2[spriteIndex+3],baseTable=this.baseTable,tileAddress=0,tileLow=0,tileHigh=0,flipX=64&attributes,flipY=0,fineY=0;flipY=128&attributes,fineY=this.ppu.scanline-y&this.spriteSize-1,16===this.spriteSize&&(baseTable=1&tileIndex?4096:0,tileIndex=-2&tileIndex,fineY>7?(fineY-=8,flipY||tileIndex++):flipY&&tileIndex++),flipY&&(fineY=8-fineY-1),tileAddress=(tileIndex<<4)+baseTable+fineY,tileLow=this.memory.read(tileAddress),tileHigh=this.memory.read(tileAddress+8),flipX&&(tileLow=bitwise.reverse(tileLow),tileHigh=bitwise.reverse(tileHigh)),this.currentSprite<this.nextSpriteCount&&this.preloadSprite(x,tileLow,tileHigh,attributes)}this.spriteProgress+=1,8===this.spriteProgress&&(this.spriteProgress=0,this.currentSprite+=1)},preloadSprite:function(x,tileLow,tileHigh,attributes){for(var mask=128,palette=16|(3&attributes)<<2,priority=32&attributes,sprite0=0===this.currentSprite&&this.sprite0Next,low=0,high=0,color=0,i=0;8>i;i++)this.nextScanlineColors[x]||(low=!!(tileLow&mask),high=!!(tileHigh&mask)<<1,color=high|low,color&&(this.nextScanlineColors[x]=palette|color,this.nextScanlinePriority[x]=priority,this.nextScanlineSprite0[x]=sprite0)),mask>>=1,x++},setPixel:function(backgroundColor){var x=this.ppu.lineCycle-1,color=this.scanlineColors[x];return!color||!this.enabled||!this.enabledLeft&&this.ppu.inLeft8px||256===this.ppu.lineCycle?backgroundColor:(color&&this.scanlineSprite0[x]&&backgroundColor&&(this.ppu.sprite0Hit=!0),backgroundColor&&this.scanlinePriority[x]?backgroundColor:color)}},module.exports=Sprites},{"../utils/bitwise":32}],32:[function(require,module,exports){function calcReverse(original){var i,reverse=0;for(i=7;i>=0;i--)reverse|=(1&original)<<i,original>>>=1;return reverse}var i,reverseLookup=new Uint8Array(256);for(i=0;256>i;i++)reverseLookup[i]=calcReverse(i);exports.reverse=function(byte){return reverseLookup[byte]}},{}],33:[function(require){function togglePlaying(el){toggleClassName(el,"nes-paused",el.nesnes.paused),toggleClassName(el,"nes-playing",!el.nesnes.paused)}function toggleClassName(el,className,flag){var classList=el.shadowRoot.querySelector(".nes-wrapper").classList;flag?classList.add(className):classList.remove(className)}function initShadowRoot(el){var template=currentDoc.querySelector("template"),root=el.createShadowRoot();if(root.appendChild(document.importNode(template.content,!0)),"undefined"!=typeof WebComponents&&WebComponents.ShadowCSS){WebComponents.ShadowCSS.shimStyling(template.content,"x-nes");var style=root.querySelector("style");style.parentNode.removeChild(style)}initEvents(el),toggleClassName(el,"nes-no-fullscreen",!fullscreen.request),toggleClassName(el,"nes-no-audio","undefined"==typeof AudioContext),el.nesnes=new NesNes(root.querySelector("canvas"))}function initAttributes(el){var value;for(var attr in attributes)value=el.getAttribute(attr),"string"==typeof value&&el.attributeChangedCallback(attr,null,value)}function initEvents(el){function getEventListener(callback){return function(e){callback.call(el,e)}}var split,eventName,selector,target,root=el.shadowRoot;for(var key in events)split=key.split(" "),eventName=split[0],selector=split[1],target=selector?root.querySelector(selector):el,target.addEventListener(eventName,getEventListener(events[key]));fullscreen.event&&(document.addEventListener(fullscreen.event,function(){toggleClassName(el,"nes-fullscreen",isFullscreen(el)),scaleCanvas(el)}),window.addEventListener("resize",function(){scaleCanvas(el)}))}function isFullscreen(el){return document[fullscreen.element]===unwrap(el)}function unwrap(el){return"undefined"!=typeof ShadowDOMPolyfill?ShadowDOMPolyfill.unwrap(el):el}function initMouseTimeout(el){var mouseTimeout;el.addEventListener("mousemove",function(){clearTimeout(mouseTimeout),mouseTimeout=setTimeout(function(){toggleClassName(el,"nes-mouse-inactive",!0)},1500),toggleClassName(el,"nes-mouse-inactive",!1)})}function scaleCanvas(el){var canvas=el.shadowRoot.querySelector("canvas"),dx=(canvas.style,window.innerWidth/canvas.offsetWidth),dy=window.innerHeight/canvas.offsetHeight,scale=Math.min(dx,dy),value="scale("+scale+")";isFullscreen(el)?transform(canvas,value):transform(canvas,null)}function transform(el,value){var style=el.style;style.transform=value,style.webkitTransform=value,style.oTransform=value,style.msTransform=value}function addAttributeProperties(properties,attributes){function addProperty(attr){var desc=attributes[attr],prop={get:function(){var result=this.getAttribute(attr);return"boolean"===desc.type&&(result="string"==typeof result),result},set:function(value){if("boolean"===desc.type){if(!value)return void this.removeAttribute(attr);value=""}this.setAttribute(attr,String(value))}};properties[attr]=prop}for(var attr in attributes)addProperty(attr)}function initFullscreen(){var el=document.createElement("div");return el.requestFullScreen?{request:"requestFullScreen",exit:"exitFullScreen",event:"fullscreenchange",element:"fullscreenElement"}:el.webkitRequestFullScreen?{request:"webkitRequestFullScreen",exit:"webkitExitFullscreen",event:"webkitfullscreenchange",element:"webkitFullscreenElement"}:el.mozRequestFullScreen?{request:"mozRequestFullScreen",exit:"mozCancelFullScreen",event:"mozfullscreenchange",element:"mozFullScreenElement"}:el.msRequestFullScreen?{request:"msRequestFullScreen",exit:"msExitFullscreen",event:"msfullscreenchange",element:"msFullscreenElement"}:{}}var currentDoc,NesNes=require("nesnes"),fullscreen=initFullscreen();document.currentScript&&(currentDoc=document.currentScript.ownerDocument),document._currentScript&&(currentDoc=document._currentScript.ownerDocument);var attributes={autoplay:{type:"boolean"},muted:{type:"boolean",change:function(){this.nesnes.output.audio.setEnabled(!this.muted),toggleClassName(this,"nes-muted",this.muted)}},preload:{},poster:{change:function(){if(!this.nesnes.running){var canvas=this.shadowRoot.querySelector("canvas"),ctx=canvas.getContext("2d"),img=new Image;img.src=this.getAttribute("poster"),img.onload=function(){ctx.drawImage(img,0,0)}}}},src:{change:function(){this.played&&this.load(!0)}}},properties={paused:{get:function(){return this.nesnes.paused},set:function(){}},played:{get:function(){return!!this.nesnes.cartridge},set:function(){}},volume:{get:function(){return this.nesnes.output.audio.volume},set:function(value){this.nesnes.output.audio.setVolume(value)}}};addAttributeProperties(properties,attributes);var events={"click canvas":function(){!this.played||this.paused?this.play():this.pause()},"click .nes-play":function(){this.play()},"click .nes-pause":function(){this.pause()},"click .nes-audio-enable":function(){this.muted=!1},"click .nes-audio-disable":function(){this.muted=!0},"input .nes-volume":function(e){var target=e.currentTarget;this.nesnes.output.audio.setVolume(parseInt(target.value,10)/10)},"click .nes-fullscreen-enter":function(){this[fullscreen.request]()},"click .nes-fullscreen-exit":function(){document[fullscreen.exit]()}},nesPrototype=Object.create(HTMLElement.prototype,properties);nesPrototype.createdCallback=function(){initShadowRoot(this),initAttributes(this),initMouseTimeout(this),toggleClassName(this,"nes-inactive",!0),this.autoplay?this.play():"auto"===this.preload&&this.load()},nesPrototype.attributeChangedCallback=function(name){attributes[name]&&attributes[name].change&&attributes[name].change.call(this)},nesPrototype.play=function(){this.played?(toggleClassName(this,"nes-inactive",!1),this.nesnes.play(),togglePlaying(this)):this.load(!0)},nesPrototype.pause=function(){this.nesnes.pause(),togglePlaying(this)},nesPrototype.load=function(play){var self=this;toggleClassName(this,"nes-loading",!0),this.nesnes.load(this.getAttribute("src"),function(){
play&&self.play(),toggleClassName(self,"nes-loading",!1)})},document.registerElement("x-nes",{prototype:nesPrototype})},{nesnes:3}]},{},[33]);</script><template><style>:host {
	width: 256px;
	height: 224px;

	display: block;
	overflow: hidden;
}

* {
	box-sizing: border-box;
}

/**
 * x-nes wraps everything in a div to be able to set root classes without exposing
 * those outside of the shadow root
 */
.nes-wrapper {
	position: relative;
	background-color: #000;
	padding: 0;
	margin: 0;
}

/**
 * Don't show cursor when mouse is inactive.
 */
.nes-mouse-inactive {
	cursor: none;
}

.nes-paused canvas {
	opacity: .5;
}

/**
 * Fullscreen styling.
 */
.nes-fullscreen {
	width: 100vw;
	height: 100vh;

	position: absolute;
	left: 0;
	top: 0;
}

.nes-fullscreen canvas {
	position: absolute;
	left: 50%;
	top: 50%;

	margin-left: -128px;
	margin-top: -112px;
}

/**
 * Check if the browser supports pixelated image-rendering
 */
@supports not (image-rendering: pixelated) {
	.nes-fullscreen canvas {
		image-rendering: -moz-crisp-edges;
		image-rendering: -webkit-crisp-edges;
		image-rendering: crisp-edges
	}
}

@supports (image-rendering: pixelated) {
	.nes-fullscreen canvas {
		image-rendering: pixelated
	}
}

/**
 * Emulator video output should always scale to dimensions of parent, 
 * while retaining aspect ratio.
 */
/*canvas {
	width: 100% !important;
	height: 100% !important;
	object-fit: contain;
}*/

/**
 * Crontrol bar styling.
 */
.nes-controls {
	position: absolute;
	bottom: 0;

	width: 100%;
	margin: 0;
	padding: 8px;

	background-color: #343f4a;
}

/**
 * Should controls on hover or if emulator is paused.
 */
.nes-wrapper:hover .nes-controls,
.nes-paused .nes-controls,
.nes-inactive .nes-controls {
	transform: translateY(0);
}

.nes-controls,
.nes-wrapper.nes-mouse-inactive .nes-controls {
	/**
	 * Controls are hidden by default (and when mouse is inactive)
	 */
	transform: translateY(100%);
	transition: transform .2s ease;
}

.nes-main-controls {
	float: left;
}

.nes-secondary-controls {
	float: right;
}

/**
 * Button styling
 */
button {
	border: none;
	border-radius: 3px;

	background: none;
	cursor: pointer;

	transition: background .2s ease;
}

button:hover {
	background-color: #3498db;
}

button path {
	stroke: none;
	fill: #cbd0d3;

	transition: fill .2s ease;
}

button:hover path {
	fill: #fff;
}

/**
 * Toggle play/pause buttons visibility depending on state.
 */
.nes-pause {
	display: none;
}

.nes-play {
	display: inline;
}

.nes-playing .nes-pause {
	display: inline;
}

.nes-playing .nes-play {
	display: none;
}

/**
 * Toggle enter/exit fullscreens button visibility depending on state.
 */
.nes-fullscreen-exit {
	display: none;
}

.nes-fullscreen-enter {
	display: inline;
}

.nes-fullscreen .nes-fullscreen-exit {
	display: inline;
}

.nes-fullscreen .nes-fullscreen-enter {
	display: none;
}

/**
 * Toggle enable/disable sound buttons visibility depending on state.
 */
 .nes-audio-enable {
	display: none;
}

.nes-audio-disable {
	display: inline;
}

.nes-muted .nes-audio-enable {
	display: inline;
}

.nes-muted .nes-audio-disable {
	display: none;
}

/**
 * Style audio volume slider.
 * This is a pain, by the way. Why is this so hard?
 */
input[type=range] {
	-webkit-appearance: none;
	background: none;

	position: relative;
	width: 60px;
	margin: 0;
	padding: 0;
}
input[type=range]:focus {
    outline: none;
}

/**
 * The slider track.
 */

 /* Webkit/Blink */
input[type=range]::-webkit-slider-runnable-track {
    width: 100%;
    height: 5px;
    position: relative;
    bottom: 6px;
    background: #565d64;
    border: none;
    border-radius: 3px;
}

/* Firefox */
input[type=range]::-moz-range-track {
    width: 100%;
    height: 5px;
    background: #565d64;
    border: none;
    border-radius: 3px;
}

/**
 * The slider thumb.
 */

 /* Webkit/Blink */
input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    border: none;
    height: 12px;
    width: 12px;
    border-radius: 50%;
    background: #cbd0d3;
    margin-top: -4px;
}
input[type=range]:focus::-webkit-slider-thumb {
    background: #3498db;
}

/* Firefox */
input[type=range]::-moz-range-thumb {
    border: none;
    height: 12px;
    width: 12px;
    border-radius: 50%;
    background: #cbd0d3;
    margin-top: -4px;
}
input[type=range]:focus::-moz-range-thumb {
    background: #3498db;
}

/* IE */
input[type=range]::-ms-track {
	width: 100%;
	height: 12px;
	margin: 0;
	padding: 0;

	cursor: pointer;
	background: transparent;
	border-color: transparent;
	color: transparent;
}
input[type=range]::-ms-fill-lower {
	height: 5px;
	background: #565d64;
}
input[type=range]::-ms-fill-upper {
	height: 5px;
	background: #565d64;
}
input[type=range]::-ms-thumb {
	border: none;
	height: 12px;
	width: 12px;
	border-radius: 50%;
	background: #cbd0d3;
}
input[type=range]:focus::-ms-thumb {
	background: #3498db;
}

.nes-no-fullscreen .nes-fullscreen-exit,
.nes-no-fullscreen .nes-fullscreen-enter,
.nes-no-audio .nes-audio-enable,
.nes-no-audio .nes-audio-disable,
.nes-no-audio .nes-volume {
	display: none;
}
</style><div class="nes-wrapper"><canvas width="256" height="224"></canvas><div class="nes-controls"><div class="nes-main-controls"><button class="nes-play"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18" viewBox="0 0 18 18">
<path d="M5 4.914l6.915 4.086-6.915 4.086v-8.172zM4 2c-0.552 0-1 0.448-1 1v12c0 0.552 0.448 1 1 1l10.569-6.246c0.267-0.158 0.431-0.444 0.431-0.754s-0.164-0.597-0.431-0.754l-10.569-6.246z"></path>
</svg>
</button><button class="nes-pause"><svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" sketch:type="MSPage">
        <g id="pause" sketch:type="MSLayerGroup" transform="translate(2.000000, 2.000000)">
            <path d="M0,2 L0,12 C5.24848613e-17,14 2,14 2,14 L4,14 C4,14 6,14 6,12 C6,11.786438 6,11.572876 6,11 L6,2 C6,3.17446247e-09 4,0 4,0 L2,0 C2,0 0,0 0,2 Z M2,2 L4,2 L4,12 L2,12 L2,2 Z" id="Path-1" sketch:type="MSShapeGroup"></path>
            <path d="M8,2 L8,12 C8,14 10,14 10,14 L12,14 C12,14 14,14 14,12 C14,11.786438 14,11.572876 14,11 L14,2 C14,3.17446247e-09 12,0 12,0 L10,0 C10,0 8,0 8,2 Z M10,2 L12,2 L12,12 L10,12 L10,2 Z" id="Path-2" sketch:type="MSShapeGroup"></path>
        </g>
    </g>
</svg></button></div><div class="nes-secondary-controls"><button class="nes-audio-enable"><svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" sketch:type="MSPage">
        <g id="sound" sketch:type="MSLayerGroup" transform="translate(0.000000, 2.000000)">
            <path d="M9.214,0 C9.103,0 8.989,0.032 8.88,0.101 L4.832,2.911 C4.749,2.969 4.65,3 4.549,3 L0.996,3 C0.446,3 1.33226763e-15,3.448 1.33226763e-15,4 L1.33226763e-15,10 C1.33226763e-15,10.552 0.446,11 0.996,11 L4.549,11 C4.651,11 4.749,11.031 4.832,11.089 L8.88,13.899 C8.989,13.968 9.103,14 9.214,14 C9.606,14 9.961,13.6 9.961,13.051 L9.961,0.95 C9.961,0.4 9.606,0.001 9.214,0.001 L9.214,0 Z M7.969,10.834 L5.582,9.177 C5.416,9.062 5.218,8.999 5.016,8.999 L2.491,8.999 C2.216,8.999 1.993,8.775 1.993,8.499 L1.993,5.499 C1.993,5.223 2.216,4.999 2.491,4.999 L5.016,4.999 C5.218,4.999 5.416,4.937 5.582,4.821 L7.969,3.164 L7.969,10.833 L7.969,10.834 Z" id="Shape" sketch:type="MSShapeGroup"></path>
            <path d="M14.934,6.799 C14.848,5.051 13.42,3.808 12.427,3.15 C11.957,2.838 11.333,3.028 11.102,3.558 L11.064,3.644 C10.876,4.075 11.019,4.583 11.4,4.838 C12.106,5.311 12.986,6.085 13.024,6.903 C13.056,7.579 12.471,8.371 11.361,9.173 C10.963,9.461 10.832,10.012 11.076,10.448 L11.118,10.523 C11.384,10.998 11.984,11.147 12.418,10.835 C14.158,9.584 15.004,8.229 14.934,6.798 L14.934,6.799 Z" id="Shape" sketch:type="MSShapeGroup"></path>
            <path d="M17.934,6.799 C17.848,5.051 16.42,3.808 15.427,3.15 C14.957,2.838 14.333,3.028 14.102,3.558 L14.064,3.644 C13.876,4.075 14.019,4.583 14.4,4.838 C15.106,5.311 15.986,6.085 16.024,6.903 C16.056,7.579 15.471,8.371 14.361,9.173 C13.963,9.461 13.832,10.012 14.076,10.448 L14.118,10.523 C14.384,10.998 14.984,11.147 15.418,10.835 C17.158,9.584 18.004,8.229 17.934,6.798 L17.934,6.799 Z" id="Shape-2" sketch:type="MSShapeGroup" transform="translate(15.945467, 6.999165) rotate(-180.000000) translate(-15.945467, -6.999165) "></path>
        </g>
    </g>
</svg></button><button class="nes-audio-disable"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18" viewBox="0 0 18 18">
<path d="M10.214 2c-0.111 0-0.225 0.032-0.334 0.101l-4.048 2.81c-0.083 0.058-0.182 0.089-0.283 0.089h-3.553c-0.55 0-0.996 0.448-0.996 1v6c0 0.552 0.446 1 0.996 1h3.553c0.102 0 0.2 0.031 0.283 0.089l4.048 2.81c0.109 0.069 0.223 0.101 0.334 0.101 0.392 0 0.747-0.4 0.747-0.949v-12.101c0-0.55-0.355-0.949-0.747-0.949zM8.969 12.834l-2.387-1.657c-0.166-0.115-0.364-0.178-0.566-0.178h-2.525c-0.275 0-0.498-0.224-0.498-0.5v-3c0-0.276 0.223-0.5 0.498-0.5h2.525c0.202 0 0.4-0.062 0.566-0.178l2.387-1.657v7.669z"></path>
<path d="M16.934 8.799c-0.086-1.748-1.514-2.991-2.507-3.649-0.47-0.312-1.094-0.122-1.325 0.408l-0.038 0.086c-0.188 0.431-0.045 0.939 0.336 1.194 0.706 0.473 1.586 1.247 1.624 2.065 0.032 0.676-0.553 1.468-1.663 2.27-0.398 0.288-0.529 0.839-0.285 1.275l0.042 0.075c0.266 0.475 0.866 0.624 1.3 0.312 1.74-1.251 2.586-2.606 2.516-4.037z"></path>
</svg>
</button><input type="range" min="0" max="10" step="0.5" value="10" class="nes-volume"/><button class="nes-fullscreen-enter"><svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <!-- Generator: Sketch 3.2.2 (9983) - http://www.bohemiancoding.com/sketch -->
    <title>expand</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" sketch:type="MSPage">
        <g id="expand" sketch:type="MSLayerGroup" transform="translate(-1.000000, -1.000000)">
            <path d="M7.00325,17.01 L7.00325,13.377 L8.29625,14.694 C8.68825,15.082 9.32125,15.082 9.71325,14.694 C10.10525,14.306 10.10425,13.678 9.71325,13.291 L6.74625,10.291 C6.55825,10.105 6.30425,10 6.03725,10 C6.02625,10 6.01425,10 6.00325,10.001 C5.99225,10.002 5.98025,10 5.96925,10 C5.70325,10 5.44825,10.105 5.26025,10.291 L2.29325,13.291 C1.90225,13.679 1.90225,14.307 2.29325,14.694 C2.68425,15.081 3.31825,15.082 3.71025,14.694 L5.00425,13.377 L5.00425,17.01 C5.00425,17.557 5.44725,18 5.99425,18 L6.01225,18 C6.55925,18 7.00225,17.557 7.00225,17.01 L7.00325,17.01 Z" id="Shape" sketch:type="MSShapeGroup" transform="translate(6.003438, 14.000000) rotate(-135.000000) translate(-6.003438, -14.000000) "></path>
            <path d="M15.0066876,5.377 L16.2996876,6.694 C16.6916876,7.082 17.3246876,7.082 17.7166876,6.694 C18.1086876,6.306 18.1076876,5.678 17.7166876,5.291 L14.7496876,2.291 C14.5616876,2.105 14.3076876,2 14.0406876,2 C14.0296876,2 14.0176876,2 14.0066876,2.001 C13.9956876,2.002 13.9836876,2 13.9726876,2 C13.7066876,2 13.4516876,2.105 13.2636876,2.291 L10.2966876,5.291 C9.90568756,5.679 9.90568756,6.307 10.2966876,6.694 C10.6876876,7.081 11.3216876,7.082 11.7136876,6.694 L13.0076876,5.377 L13.0076876,9.01 C13.0076876,9.557 13.4506876,10 13.9976876,10 C14.5626876,10 15.0056876,9.557 15.0056876,9.01 L15.0066876,5.377 Z" id="Shape-2" sketch:type="MSShapeGroup" transform="translate(14.006875, 6.000000) rotate(45.000000) translate(-14.006875, -6.000000) "></path>
        </g>
    </g>
</svg></button><button class="nes-fullscreen-exit"><svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <!-- Generator: Sketch 3.2.2 (9983) - http://www.bohemiancoding.com/sketch -->
    <title>collapse</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1">
        <g id="collapse" sketch:type="MSLayerGroup" transform="translate(-1.000000, -1.000000)">
            <path d="M15.00325,9.01 L15.00325,5.377 L16.29625,6.694 C16.68825,7.082 17.32125,7.082 17.71325,6.694 C18.10525,6.306 18.10425,5.678 17.71325,5.291 L14.74625,2.291 C14.55825,2.105 14.30425,2 14.03725,2 C14.02625,2 14.01425,2 14.00325,2.001 C13.99225,2.002 13.98025,2 13.96925,2 C13.70325,2 13.44825,2.105 13.26025,2.291 L10.29325,5.291 C9.90225,5.679 9.90225,6.307 10.29325,6.694 C10.68425,7.081 11.31825,7.082 11.71025,6.694 L13.00425,5.377 L13.00425,9.01 C13.00425,9.557 13.44725,10 13.99425,10 L14.01225,10 C14.55925,10 15.00225,9.557 15.00225,9.01 L15.00325,9.01 Z" id="Shape" sketch:type="MSShapeGroup" transform="translate(14.003438, 6.000000) rotate(-135.000000) translate(-14.003438, -6.000000) "></path>
            <path d="M7.00668756,13.377 L8.29968756,14.694 C8.69168756,15.082 9.32468756,15.082 9.71668756,14.694 C10.1086876,14.306 10.1076876,13.678 9.71668756,13.291 L6.74968756,10.291 C6.56168756,10.105 6.30768756,10 6.04068756,10 C6.02968756,10 6.01768756,10 6.00668756,10.001 C5.99568756,10.002 5.98368756,10 5.97268756,10 C5.70668756,10 5.45168756,10.105 5.26368756,10.291 L2.29668756,13.291 C1.90568756,13.679 1.90568756,14.307 2.29668756,14.694 C2.68768756,15.081 3.32168756,15.082 3.71368756,14.694 L5.00768756,13.377 L5.00768756,17.01 C5.00768756,17.557 5.45068756,18 5.99768756,18 C6.56268756,18 7.00568756,17.557 7.00568756,17.01 L7.00668756,13.377 Z" id="Shape-2" sketch:type="MSShapeGroup" transform="translate(6.006875, 14.000000) rotate(45.000000) translate(-6.006875, -14.000000) "></path>
        </g>
    </g>
</svg></button></div></div></div></template>